<!-- 
 ******************************************************************************
 * Copyright (c) 2016 Oracle
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *    Konstantin Komissarchik - initial implementation and ongoing maintenance
 ******************************************************************************
-->

<project name="corundum.macro.load-configuration">

  <macrodef name="load-configuration">
    <attribute name="name"/>
    <sequential>

      <if>
        <not><isset property="repositories.@{name}"/></not>
        <then>

          <echo message="Loading configuration @{name}..."/>

          <property file="${releng.dir}/repositories-@{name}.properties" prefix="."/>

          <if>
            <isset property=".p2.repositories"/>
            <then>
              <for list="${.p2.repositories}" param="repo">
                <sequential>
                  <load-repository location="@{repo}" property="repositories.@{name}"/>
                </sequential>
              </for>
            </then>
          </if>
          
          <if>
            <istrue value="${.legacy.mac.layout}"/>
            <then>
              <var name="legacy.mac.layout.@{name}" value="true"/>
            </then>
            <else>
              <var name="legacy.mac.layout.@{name}" value="false"/>
            </else>
          </if>
          
          <post-load-configuration name="@{name}"/>

          <var name=".eclipse.platform.build" unset="true"/>
          <var name=".p2.repositories" unset="true"/>
          <var name=".legacy.mac.layout" unset="true"/>

        </then>
      </if>

    </sequential>
  </macrodef>
  
</project>
